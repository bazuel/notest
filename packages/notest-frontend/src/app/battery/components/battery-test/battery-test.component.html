<div *ngIf="sessionBattery" class='p-4 flex flex-row w-full justify-between'>
  <div class='flex flex-row gap-4'>
    <h1>{{sessionBattery.name || 'Battery Test'}}</h1>
    <nt-switch
      *ngIf='sessionBattery.session_list.length > 0 && sessionBattery.nt_batteryid'
      [(switched)]='sessionBattery.active'
      (switchedChange)='save()'>Enabled
    </nt-switch>
  </div>
  <div class='flex flex-row items-center'>
    <label class='text-xl my-4 mr-4'>Settings</label>
    <div class='relative'>
      <nt-icon title='Open battery settings' name='settings' class='h-6 w-6 text-gray-500 cursor-pointer'
               (click)='showSettings = !showSettings'></nt-icon>
      <div *ngIf='showSettings'
           class='absolute bo-popup-content shadow-2xl rounded-lg right-0 w-fit h-fit p-3 flex flex-col gap-y-5'>
        <div>
          <label class='mt-4'>Name</label>
          <p *ngIf='invalidTitle' class='text-red-800'>Invalid Name</p>
          <input class='w-48' [(ngModel)]='sessionBattery.name' placeholder='Name' />
        </div>
        <div>
          <label class='mt-4'>Schedule Date</label>
          <p *ngIf='invalidScheduledTime' class='text-red-800'> Set a Valid Schedule Time</p>
          <nt-cron [(scheduleTime)]='sessionBattery.scheduled_time'></nt-cron>
          <label class='mt-4'> Cron Expression</label>
          <input [(ngModel)]='sessionBattery.scheduled_time' [placeholder]='"* * * * *"' />
        </div>
        <nt-switch
          class='mt-2'
          [switched]='sessionBattery.backend_type == "full"'
          (switchedChange)='toggleBackend()'>Frontend isolated
        </nt-switch>
        <div class='flex flex-row items-center gap-2'>
          <div class='flex flex-col'>
            <label class='mt-4'>Battery sessions</label>
            <nt-async-autocomplete
              [searchFunction]='findBatteryByUseridAndTitle'
              property='title'
              placeholder='Select User Session'
              (itemSelected)='onSessionSelected($event)'></nt-async-autocomplete>
          </div>

        </div>
        <div class='flex flex-col h-52 overflow-auto scrollbar-sm'>
          <div *ngFor='let session of sessionsSelected' class='w-fit mt-4 items-center'>
            <nt-badge (click)='deleteSession(session)'>
              {{session.info.title}}
            </nt-badge>
            <nt-screenshot class='card' [reference]=session.reference></nt-screenshot>
          </div>
        </div>
        <div class='flex flex-row gap-2'>
          <button class='bo-button w-14 text-center mt-2' (click)='save()'>Save</button>
          <button *ngIf='sessionBattery.nt_batteryid' class='bo-button w-16 text-center mt-2'
                  (click)='delete()'>Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>




